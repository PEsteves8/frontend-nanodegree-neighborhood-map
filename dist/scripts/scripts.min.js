function initMap(){return new google.maps.Map(document.getElementById("map"),{center:new google.maps.LatLng(41.147273,-8.61437),mapTypeControl:!1,zoom:17,scrollwheel:!0})}String.prototype.removeAccents=function(){var e=this,n={"[ÀÁÂÃÄÅĀĂǍẠẢẤẦẨẪẬẮẰẲẴẶǺĄ]":"A","[àáâãäåāăǎạảấầẩẫậắằẳẵặǻą]":"a","[ÇĆĈĊČ]":"C","[çćĉċč]":"c","[ÈÉÊËĒĔĖĘĚẸẺẼẾỀỂỄỆ]":"E","[èéêëēĕėęěẹẻẽếềểễệ]":"e","[ÌÍÎÏĨĪĬĮİǏỈỊ]":"I","[ìíîïĩīĭįıǐỉị]":"i","[ÒÓÔÕÖØŌŎŐƠǑǾỌỎỐỒỔỖỘỚỜỞỠỢ]":"O","[òóôõöøōŏőơǒǿọỏốồổỗộớờởỡợð]":"o","[ÙÚÛÜŨŪŬŮŰŲƯǓǕǗǙǛỤỦỨỪỬỮỰ]":"U","[ùúûüũūŭůűųưǔǖǘǚǜụủứừửữự]":"u"};for(var t in n)e=e.replace(new RegExp(t,"g"),n[t]);return e},$(".hasTooltip").each(function(){$(this).qtip({content:{text:$(this).next("div"),title:"Info",button:"Close"},style:{classes:"qtip-tipsy",width:"220"},hide:{event:!1},show:{event:"click mouseenter",ready:!0},hide:{event:"unfocus",fixed:!0},position:{my:"top right",at:"bottom left",viewport:$(window),target:$(this)}})});var loadingIcon="<div class='uil-ring-css' style='transform:scale(0.41);'><div>",Location=function(e){this.name=e.name,this.lat=e.lat,this.lng=e.lng,this.isVisible=ko.observable(!0),this.infoOpen=ko.observable(!1),this.infoContent=loadingIcon,this.type=e.type},ViewModel=function(e){var n=this;n.googleMap=e,$(window).width()>739?this.listIsHidden=ko.observable(!1):this.listIsHidden=ko.observable(!0),this.toggleListVisible=function(){$(".collapsable").animate({height:"toggle"},200),n.listIsHidden(!n.listIsHidden())},this.locationList=ko.observableArray([]),locations.forEach(function(e){n.locationList.push(new Location(e))}),n.locationList.sort(function(e,n){return e.name>n.name?1:-1}),n.locationList().forEach(function(e){e.marker=new google.maps.Marker({position:{lat:e.lat,lng:e.lng},map:n.googleMap,title:e.name});var t=new google.maps.InfoWindow({content:e.infoContent});e.toggleWindowOnClick=function(){null===t.getMap()||"undefined"==typeof t.getMap()?(e.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.marker.setAnimation(null)},750),t.open(n.googleMap,e.marker),n.googleMap.panTo(e.marker.getPosition()),e.infoOpen(!0),e.infoContent===loadingIcon&&$.ajax({url:"https://api.foursquare.com/v2/venues/search?client_id=CHNBXXBO4XIC24AAH3JY3ZI4A1G0WBM24U3SEVDIKAFWKFDR&client_secret=FKC5XJA0JJVKFCQNEDABMH1GWSVPOES2GE0PVEVIQK4XK43X&v=20130815&limit=1&ll="+e.lat+","+e.lng+"&query="+e.name,cache:!0,dataType:"json",success:function(n){$.ajax({url:"https://api.foursquare.com/v2/venues/"+n.response.venues[0].id+"?client_id=CHNBXXBO4XIC24AAH3JY3ZI4A1G0WBM24U3SEVDIKAFWKFDR&client_secret=FKC5XJA0JJVKFCQNEDABMH1GWSVPOES2GE0PVEVIQK4XK43X&v=20130815",cache:!0,dataType:"json",success:function(e){var n={icon:"",name:"",photo:"",hours:"",schedule:"",rating:"",comments:[],url:"",phone:"",street:"",city:"",country:""};e.response.venue.categories[0].icon.prefix&&(n.icon=e.response.venue.categories[0].icon.prefix+"bg_32"+e.response.venue.categories[0].icon.suffix),e.response.venue.name&&(n.name=e.response.venue.name),e.response.venue.bestPhoto&&(n.photo=e.response.venue.bestPhoto.prefix+"300x200"+e.response.venue.bestPhoto.suffix),e.response.venue.hours&&(n.hours=e.response.venue.hours.status),e.response.venue.hours&&(n.schedule=e.response.venue.hours.timeframes[0].days+" - "+e.response.venue.hours.timeframes[0].open[0].renderedTime),e.response.venue.rating&&(n.rating=e.response.venue.rating),e.response.venue.phrases&&e.response.venue.phrases.forEach(function(e){n.comments.push(e.sample.text)}),e.response.venue.canonicalUrl&&(n.url=e.response.venue.canonicalUrl),e.response.venue.contact.formattedPhone&&(n.phone=e.response.venue.contact.formattedPhone),e.response.venue.location.formattedAddress[0]&&(n.street=e.response.venue.location.formattedAddress[0]),e.response.venue.location.formattedAddress[1]&&(n.city=e.response.venue.location.formattedAddress[1]),e.response.venue.location.formattedAddress[2]&&(n.country=e.response.venue.location.formattedAddress[2]);var o=$("#infoWindowTpl").html(),a=Mustache.to_html(o,n);t.setContent(a)},error:function(){e.infoContent("<h2>"+e.name()+"</h2><h3>Unable to retrieve info from Foursquare.</h3>")}})},error:function(){e.infoContent("<h2>"+e.name()+"</h2><h3>Unable to retrieve info from Foursquare.</h3>")}})):(t.close(),e.infoOpen(!1))},e.marker.addListener("click",e.toggleWindowOnClick),google.maps.event.addListener(t,"closeclick",function(){e.infoOpen(!1)})}),this.queryValue=ko.observable(""),this.barShow=ko.observable(!0),this.clubShow=ko.observable(!0),this.restaurantShow=ko.observable(!0),this.filter=function(){for(var e=$(".search").val(),t=0;t<n.locationList().length;t++){var o=n.locationList()[t].type.indexOf("Bar")>=0&&n.barShow(),a=n.locationList()[t].type.indexOf("Club")>=0&&n.clubShow(),s=n.locationList()[t].type.indexOf("Restaurant")>=0&&n.restaurantShow(),i=n.locationList()[t].name.toLowerCase().removeAccents().indexOf(e.toLowerCase())>=0;i&&(o||a||s)?n.locationList()[t].isVisible()===!1&&(n.locationList()[t].marker.setMap(n.googleMap),n.locationList()[t].isVisible(!0)):(n.locationList()[t].marker.setMap(null),n.locationList()[t].isVisible(!1))}},this.queryValue.subscribe(this.filter),this.barShow.subscribe(this.filter),this.clubShow.subscribe(this.filter),this.restaurantShow.subscribe(this.filter)};$(window).load(function(){var e=initMap();ko.applyBindings(new ViewModel(e))});var locations=[{name:"Café Piolho",lat:41.146882,lng:-8.616246,type:["Bar","Restaurant"]},{name:"Galerias de Paris",lat:41.147219,lng:-8.61429,type:["Bar"]},{name:"We Love Porto",lat:41.147304,lng:-8.614215,type:["Club"]},{name:"Plano B",lat:41.146512,lng:-8.613855,type:["Club"]},{name:"Tendinha dos Clérigos",lat:41.147454,lng:-8.613222,type:["Club"]},{name:"Espaço 77",lat:41.149607,lng:-8.615973,type:["Bar","Restaurant"]},{name:"Radio Bar",lat:41.148473,lng:-8.612727,type:["Bar"]},{name:"Taskinha do Alex",lat:41.151329,lng:-8.613903,type:["Bar","Restaurant"]},{name:"Á Grande e à Francesa",lat:41.146955,lng:-8.616548,type:["Bar","Restaurant"]},{name:"RendezVous Bar",lat:41.147085,lng:-8.614045,type:["Bar"]},{name:"MaoMaria",lat:41.147008,lng:-8.613821,type:["Bar"]},{name:"The Gin Club",lat:41.14689,lng:-8.613869,type:["Bar"]},{name:"Confeitaria Tamisa",lat:41.148347,lng:-8.612828,type:["Food"]},{name:"Casa do Livro",lat:41.147408,lng:-8.614355,type:["Bar"]},{name:"Destilaria",lat:41.147402,lng:-8.613844,type:["Bar"]},{name:"MoreClub",lat:41.14723,lng:-8.614256,type:["Club"]},{name:"The Wall",lat:41.147078,lng:-8.613828,type:["Bar"]},{name:"Boulevard",lat:41.147452,lng:-8.610863,type:["Club"]},{name:"Villa Porto",lat:41.147602,lng:-8.61007,type:["Club"]},{name:"Pitch Club",lat:41.147203,lng:-8.60814,type:["Club"]},{name:"Bar Baixa",lat:41.146742,lng:-8.613894,type:["Bar"]},{name:"Café Candelabro",lat:41.149952,lng:-8.613048,type:["Bar","Food"]},{name:"Armazém do Chá",lat:41.1495,lng:-8.614054,type:["Bar","Club"]},{name:"Costa Coffee",lat:41.14594,lng:-8.614749,type:["Restaurant"]},{name:"Adega Leonor",lat:41.146409,lng:-8.6168,type:["Bar"]},{name:"Baixaria",lat:41.148307,lng:-8.612094,type:["Bar"]},{name:"Pausa Bar",lat:41.148638,lng:-8.61426,type:["Bar"]}];